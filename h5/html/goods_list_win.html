<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../css/aui-flex.css" />
    <link rel="stylesheet" type="text/css" href="../ali_icon/iconfont.css" />
</head>

<body>
    <div id="app">
        <header class="aui-bar aui-bar-nav aui-bar-light" id="header" style="background-image: none;">
          <a class="aui-pull-left aui-btn"></a>
            <div class="aui-title" style="left:0rem; right: 0rem;" onclick="$util.openWindow('search_page_win')">
                <div class="aui-searchbar aui-bg-white" id="search">
                    <div class="aui-searchbar-input aui-border-radius aui-bg-default">
                        <i class="aui-iconfont aui-icon-search"></i>
                        <input type="search" placeholder="Introduzca el contenido de la búsqueda" id="search-input" disabled>
                        <div class="aui-searchbar-clear-btn">
                            <i class="aui-iconfont aui-icon-close"></i>
                        </div>
                    </div>
                    <div class="aui-searchbar-btn" tapmode>Cancelar</div>
                </div>
            </div>
        </header>

        <footer class="aui-bar aui-bar-tab" id="footer">
            <div class="aui-bar-tab-item" tapmode onclick="$util.openWindow('index_win')">
                <i class="aui-iconfont iconfont icon-shouye"></i>
                <div class="aui-bar-tab-label">Página</div>
            </div>
            <div class="aui-bar-tab-item aui-active">
                <i class="aui-iconfont iconfont icon-leimupinleifenleileibie"></i>
                <div class="aui-bar-tab-label">Productos</div>
            </div>
            <div class="aui-bar-tab-item" tapmode onclick="$util.openWindow('cart_list_win')">
                <i class="aui-iconfont iconfont icon-gouwuche"></i>
                <div class="aui-bar-tab-label">Carro</div>
            </div>
            <div class="aui-bar-tab-item" tapmode onclick="$util.openWindow('home_win')">
                <i class="aui-iconfont iconfont icon-people"></i>
                <div class="aui-bar-tab-label">Mía</div>
            </div>
        </footer>
    </div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/util.js"></script>
<script type="text/javascript" src="../script/vue.min.js"></script>
<script type="text/javascript" src="data:application/octet-stream;base64,OyhmdW5jdGlvbiAoKSB7DQoJJ3VzZSBzdHJpY3QnOw0KDQoJLyoqDQoJICogQHByZXNlcnZlIEZhc3RDbGljazogcG9seWZpbGwgdG8gcmVtb3ZlIGNsaWNrIGRlbGF5cyBvbiBicm93c2VycyB3aXRoIHRvdWNoIFVJcy4NCgkgKg0KCSAqIEBjb2RpbmdzdGFuZGFyZCBmdGxhYnMtanN2Mg0KCSAqIEBjb3B5cmlnaHQgVGhlIEZpbmFuY2lhbCBUaW1lcyBMaW1pdGVkIFtBbGwgUmlnaHRzIFJlc2VydmVkXQ0KCSAqIEBsaWNlbnNlIE1JVCBMaWNlbnNlIChzZWUgTElDRU5TRS50eHQpDQoJICovDQoNCgkvKmpzbGludCBicm93c2VyOnRydWUsIG5vZGU6dHJ1ZSovDQoJLypnbG9iYWwgZGVmaW5lLCBFdmVudCwgTm9kZSovDQoNCg0KCS8qKg0KCSAqIEluc3RhbnRpYXRlIGZhc3QtY2xpY2tpbmcgbGlzdGVuZXJzIG9uIHRoZSBzcGVjaWZpZWQgbGF5ZXIuDQoJICoNCgkgKiBAY29uc3RydWN0b3INCgkgKiBAcGFyYW0ge0VsZW1lbnR9IGxheWVyIFRoZSBsYXllciB0byBsaXN0ZW4gb24NCgkgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnM9e31dIFRoZSBvcHRpb25zIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0cw0KCSAqLw0KCWZ1bmN0aW9uIEZhc3RDbGljayhsYXllciwgb3B0aW9ucykgew0KCQl2YXIgb2xkT25DbGljazsNCg0KCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsNCg0KCQkvKioNCgkJICogV2hldGhlciBhIGNsaWNrIGlzIGN1cnJlbnRseSBiZWluZyB0cmFja2VkLg0KCQkgKg0KCQkgKiBAdHlwZSBib29sZWFuDQoJCSAqLw0KCQl0aGlzLnRyYWNraW5nQ2xpY2sgPSBmYWxzZTsNCg0KDQoJCS8qKg0KCQkgKiBUaW1lc3RhbXAgZm9yIHdoZW4gY2xpY2sgdHJhY2tpbmcgc3RhcnRlZC4NCgkJICoNCgkJICogQHR5cGUgbnVtYmVyDQoJCSAqLw0KCQl0aGlzLnRyYWNraW5nQ2xpY2tTdGFydCA9IDA7DQoNCg0KCQkvKioNCgkJICogVGhlIGVsZW1lbnQgYmVpbmcgdHJhY2tlZCBmb3IgYSBjbGljay4NCgkJICoNCgkJICogQHR5cGUgRXZlbnRUYXJnZXQNCgkJICovDQoJCXRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7DQoNCg0KCQkvKioNCgkJICogWC1jb29yZGluYXRlIG9mIHRvdWNoIHN0YXJ0IGV2ZW50Lg0KCQkgKg0KCQkgKiBAdHlwZSBudW1iZXINCgkJICovDQoJCXRoaXMudG91Y2hTdGFydFggPSAwOw0KDQoNCgkJLyoqDQoJCSAqIFktY29vcmRpbmF0ZSBvZiB0b3VjaCBzdGFydCBldmVudC4NCgkJICoNCgkJICogQHR5cGUgbnVtYmVyDQoJCSAqLw0KCQl0aGlzLnRvdWNoU3RhcnRZID0gMDsNCg0KDQoJCS8qKg0KCQkgKiBJRCBvZiB0aGUgbGFzdCB0b3VjaCwgcmV0cmlldmVkIGZyb20gVG91Y2guaWRlbnRpZmllci4NCgkJICoNCgkJICogQHR5cGUgbnVtYmVyDQoJCSAqLw0KCQl0aGlzLmxhc3RUb3VjaElkZW50aWZpZXIgPSAwOw0KDQoNCgkJLyoqDQoJCSAqIFRvdWNobW92ZSBib3VuZGFyeSwgYmV5b25kIHdoaWNoIGEgY2xpY2sgd2lsbCBiZSBjYW5jZWxsZWQuDQoJCSAqDQoJCSAqIEB0eXBlIG51bWJlcg0KCQkgKi8NCgkJdGhpcy50b3VjaEJvdW5kYXJ5ID0gb3B0aW9ucy50b3VjaEJvdW5kYXJ5IHx8IDEwOw0KDQoNCgkJLyoqDQoJCSAqIFRoZSBGYXN0Q2xpY2sgbGF5ZXIuDQoJCSAqDQoJCSAqIEB0eXBlIEVsZW1lbnQNCgkJICovDQoJCXRoaXMubGF5ZXIgPSBsYXllcjsNCg0KCQkvKioNCgkJICogVGhlIG1pbmltdW0gdGltZSBiZXR3ZWVuIHRhcCh0b3VjaHN0YXJ0IGFuZCB0b3VjaGVuZCkgZXZlbnRzDQoJCSAqDQoJCSAqIEB0eXBlIG51bWJlcg0KCQkgKi8NCgkJdGhpcy50YXBEZWxheSA9IG9wdGlvbnMudGFwRGVsYXkgfHwgMjAwOw0KDQoJCS8qKg0KCQkgKiBUaGUgbWF4aW11bSB0aW1lIGZvciBhIHRhcA0KCQkgKg0KCQkgKiBAdHlwZSBudW1iZXINCgkJICovDQoJCXRoaXMudGFwVGltZW91dCA9IG9wdGlvbnMudGFwVGltZW91dCB8fCA3MDA7DQoNCgkJaWYgKEZhc3RDbGljay5ub3ROZWVkZWQobGF5ZXIpKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQkvLyBTb21lIG9sZCB2ZXJzaW9ucyBvZiBBbmRyb2lkIGRvbid0IGhhdmUgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQNCgkJZnVuY3Rpb24gYmluZChtZXRob2QsIGNvbnRleHQpIHsNCgkJCXJldHVybiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ldGhvZC5hcHBseShjb250ZXh0LCBhcmd1bWVudHMpOyB9Ow0KCQl9DQoNCg0KCQl2YXIgbWV0aG9kcyA9IFsnb25Nb3VzZScsICdvbkNsaWNrJywgJ29uVG91Y2hTdGFydCcsICdvblRvdWNoTW92ZScsICdvblRvdWNoRW5kJywgJ29uVG91Y2hDYW5jZWwnXTsNCgkJdmFyIGNvbnRleHQgPSB0aGlzOw0KCQlmb3IgKHZhciBpID0gMCwgbCA9IG1ldGhvZHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7DQoJCQljb250ZXh0W21ldGhvZHNbaV1dID0gYmluZChjb250ZXh0W21ldGhvZHNbaV1dLCBjb250ZXh0KTsNCgkJfQ0KDQoJCS8vIFNldCB1cCBldmVudCBoYW5kbGVycyBhcyByZXF1aXJlZA0KCQlpZiAoZGV2aWNlSXNBbmRyb2lkKSB7DQoJCQlsYXllci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLm9uTW91c2UsIHRydWUpOw0KCQkJbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5vbk1vdXNlLCB0cnVlKTsNCgkJCWxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLm9uTW91c2UsIHRydWUpOw0KCQl9DQoNCgkJbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xpY2ssIHRydWUpOw0KCQlsYXllci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy5vblRvdWNoU3RhcnQsIGZhbHNlKTsNCgkJbGF5ZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcy5vblRvdWNoTW92ZSwgZmFsc2UpOw0KCQlsYXllci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIHRoaXMub25Ub3VjaEVuZCwgZmFsc2UpOw0KCQlsYXllci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIHRoaXMub25Ub3VjaENhbmNlbCwgZmFsc2UpOw0KDQoJCS8vIEhhY2sgaXMgcmVxdWlyZWQgZm9yIGJyb3dzZXJzIHRoYXQgZG9uJ3Qgc3VwcG9ydCBFdmVudCNzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24gKGUuZy4gQW5kcm9pZCAyKQ0KCQkvLyB3aGljaCBpcyBob3cgRmFzdENsaWNrIG5vcm1hbGx5IHN0b3BzIGNsaWNrIGV2ZW50cyBidWJibGluZyB0byBjYWxsYmFja3MgcmVnaXN0ZXJlZCBvbiB0aGUgRmFzdENsaWNrDQoJCS8vIGxheWVyIHdoZW4gdGhleSBhcmUgY2FuY2VsbGVkLg0KCQlpZiAoIUV2ZW50LnByb3RvdHlwZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24pIHsNCgkJCWxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBjYWxsYmFjaywgY2FwdHVyZSkgew0KCQkJCXZhciBybXYgPSBOb2RlLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyOw0KCQkJCWlmICh0eXBlID09PSAnY2xpY2snKSB7DQoJCQkJCXJtdi5jYWxsKGxheWVyLCB0eXBlLCBjYWxsYmFjay5oaWphY2tlZCB8fCBjYWxsYmFjaywgY2FwdHVyZSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJcm12LmNhbGwobGF5ZXIsIHR5cGUsIGNhbGxiYWNrLCBjYXB0dXJlKTsNCgkJCQl9DQoJCQl9Ow0KDQoJCQlsYXllci5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgY2FsbGJhY2ssIGNhcHR1cmUpIHsNCgkJCQl2YXIgYWR2ID0gTm9kZS5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcjsNCgkJCQlpZiAodHlwZSA9PT0gJ2NsaWNrJykgew0KCQkJCQlhZHYuY2FsbChsYXllciwgdHlwZSwgY2FsbGJhY2suaGlqYWNrZWQgfHwgKGNhbGxiYWNrLmhpamFja2VkID0gZnVuY3Rpb24oZXZlbnQpIHsNCgkJCQkJCWlmICghZXZlbnQucHJvcGFnYXRpb25TdG9wcGVkKSB7DQoJCQkJCQkJY2FsbGJhY2soZXZlbnQpOw0KCQkJCQkJfQ0KCQkJCQl9KSwgY2FwdHVyZSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJYWR2LmNhbGwobGF5ZXIsIHR5cGUsIGNhbGxiYWNrLCBjYXB0dXJlKTsNCgkJCQl9DQoJCQl9Ow0KCQl9DQoNCgkJLy8gSWYgYSBoYW5kbGVyIGlzIGFscmVhZHkgZGVjbGFyZWQgaW4gdGhlIGVsZW1lbnQncyBvbmNsaWNrIGF0dHJpYnV0ZSwgaXQgd2lsbCBiZSBmaXJlZCBiZWZvcmUNCgkJLy8gRmFzdENsaWNrJ3Mgb25DbGljayBoYW5kbGVyLiBGaXggdGhpcyBieSBwdWxsaW5nIG91dCB0aGUgdXNlci1kZWZpbmVkIGhhbmRsZXIgZnVuY3Rpb24gYW5kDQoJCS8vIGFkZGluZyBpdCBhcyBsaXN0ZW5lci4NCgkJaWYgKHR5cGVvZiBsYXllci5vbmNsaWNrID09PSAnZnVuY3Rpb24nKSB7DQoNCgkJCS8vIEFuZHJvaWQgYnJvd3NlciBvbiBhdCBsZWFzdCAzLjIgcmVxdWlyZXMgYSBuZXcgcmVmZXJlbmNlIHRvIHRoZSBmdW5jdGlvbiBpbiBsYXllci5vbmNsaWNrDQoJCQkvLyAtIHRoZSBvbGQgb25lIHdvbid0IHdvcmsgaWYgcGFzc2VkIHRvIGFkZEV2ZW50TGlzdGVuZXIgZGlyZWN0bHkuDQoJCQlvbGRPbkNsaWNrID0gbGF5ZXIub25jbGljazsNCgkJCWxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHsNCgkJCQlvbGRPbkNsaWNrKGV2ZW50KTsNCgkJCX0sIGZhbHNlKTsNCgkJCWxheWVyLm9uY2xpY2sgPSBudWxsOw0KCQl9DQoJfQ0KDQoJLyoqDQoJKiBXaW5kb3dzIFBob25lIDguMSBmYWtlcyB1c2VyIGFnZW50IHN0cmluZyB0byBsb29rIGxpa2UgQW5kcm9pZCBhbmQgaVBob25lLg0KCSoNCgkqIEB0eXBlIGJvb2xlYW4NCgkqLw0KCXZhciBkZXZpY2VJc1dpbmRvd3NQaG9uZSA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiV2luZG93cyBQaG9uZSIpID49IDA7DQoNCgkvKioNCgkgKiBBbmRyb2lkIHJlcXVpcmVzIGV4Y2VwdGlvbnMuDQoJICoNCgkgKiBAdHlwZSBib29sZWFuDQoJICovDQoJdmFyIGRldmljZUlzQW5kcm9pZCA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQW5kcm9pZCcpID4gMCAmJiAhZGV2aWNlSXNXaW5kb3dzUGhvbmU7DQoNCg0KCS8qKg0KCSAqIGlPUyByZXF1aXJlcyBleGNlcHRpb25zLg0KCSAqDQoJICogQHR5cGUgYm9vbGVhbg0KCSAqLw0KCXZhciBkZXZpY2VJc0lPUyA9IC9pUChhZHxob25lfG9kKS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiAhZGV2aWNlSXNXaW5kb3dzUGhvbmU7DQoNCg0KCS8qKg0KCSAqIGlPUyA0IHJlcXVpcmVzIGFuIGV4Y2VwdGlvbiBmb3Igc2VsZWN0IGVsZW1lbnRzLg0KCSAqDQoJICogQHR5cGUgYm9vbGVhbg0KCSAqLw0KCXZhciBkZXZpY2VJc0lPUzQgPSBkZXZpY2VJc0lPUyAmJiAoL09TIDRfXGQoX1xkKT8vKS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOw0KDQoNCgkvKioNCgkgKiBpT1MgNi4wLTcuKiByZXF1aXJlcyB0aGUgdGFyZ2V0IGVsZW1lbnQgdG8gYmUgbWFudWFsbHkgZGVyaXZlZA0KCSAqDQoJICogQHR5cGUgYm9vbGVhbg0KCSAqLw0KCXZhciBkZXZpY2VJc0lPU1dpdGhCYWRUYXJnZXQgPSBkZXZpY2VJc0lPUyAmJiAoL09TIFs2LTddX1xkLykudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsNCg0KCS8qKg0KCSAqIEJsYWNrQmVycnkgcmVxdWlyZXMgZXhjZXB0aW9ucy4NCgkgKg0KCSAqIEB0eXBlIGJvb2xlYW4NCgkgKi8NCgl2YXIgZGV2aWNlSXNCbGFja0JlcnJ5MTAgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0JCMTAnKSA+IDA7DQoNCgkvKioNCgkgKiBEZXRlcm1pbmUgd2hldGhlciBhIGdpdmVuIGVsZW1lbnQgcmVxdWlyZXMgYSBuYXRpdmUgY2xpY2suDQoJICoNCgkgKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fEVsZW1lbnR9IHRhcmdldCBUYXJnZXQgRE9NIGVsZW1lbnQNCgkgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBlbGVtZW50IG5lZWRzIGEgbmF0aXZlIGNsaWNrDQoJICovDQoJRmFzdENsaWNrLnByb3RvdHlwZS5uZWVkc0NsaWNrID0gZnVuY3Rpb24odGFyZ2V0KSB7DQoJCXN3aXRjaCAodGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpIHsNCg0KCQkvLyBEb24ndCBzZW5kIGEgc3ludGhldGljIGNsaWNrIHRvIGRpc2FibGVkIGlucHV0cyAoaXNzdWUgIzYyKQ0KCQljYXNlICdidXR0b24nOg0KCQljYXNlICdzZWxlY3QnOg0KCQljYXNlICd0ZXh0YXJlYSc6DQoJCQlpZiAodGFyZ2V0LmRpc2FibGVkKSB7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9DQoNCgkJCWJyZWFrOw0KCQljYXNlICdpbnB1dCc6DQoNCgkJCS8vIEZpbGUgaW5wdXRzIG5lZWQgcmVhbCBjbGlja3Mgb24gaU9TIDYgZHVlIHRvIGEgYnJvd3NlciBidWcgKGlzc3VlICM2OCkNCgkJCWlmICgoZGV2aWNlSXNJT1MgJiYgdGFyZ2V0LnR5cGUgPT09ICdmaWxlJykgfHwgdGFyZ2V0LmRpc2FibGVkKSB7DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9DQoNCgkJCWJyZWFrOw0KCQljYXNlICdsYWJlbCc6DQoJCWNhc2UgJ2lmcmFtZSc6IC8vIGlPUzggaG9tZXNjcmVlbiBhcHBzIGNhbiBwcmV2ZW50IGV2ZW50cyBidWJibGluZyBpbnRvIGZyYW1lcw0KCQljYXNlICd2aWRlbyc6DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCXJldHVybiAoL1xibmVlZHNjbGlja1xiLykudGVzdCh0YXJnZXQuY2xhc3NOYW1lKTsNCgl9Ow0KDQoNCgkvKioNCgkgKiBEZXRlcm1pbmUgd2hldGhlciBhIGdpdmVuIGVsZW1lbnQgcmVxdWlyZXMgYSBjYWxsIHRvIGZvY3VzIHRvIHNpbXVsYXRlIGNsaWNrIGludG8gZWxlbWVudC4NCgkgKg0KCSAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8RWxlbWVudH0gdGFyZ2V0IFRhcmdldCBET00gZWxlbWVudA0KCSAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgdGhlIGVsZW1lbnQgcmVxdWlyZXMgYSBjYWxsIHRvIGZvY3VzIHRvIHNpbXVsYXRlIG5hdGl2ZSBjbGljay4NCgkgKi8NCglGYXN0Q2xpY2sucHJvdG90eXBlLm5lZWRzRm9jdXMgPSBmdW5jdGlvbih0YXJnZXQpIHsNCgkJc3dpdGNoICh0YXJnZXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkgew0KCQljYXNlICd0ZXh0YXJlYSc6DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJY2FzZSAnc2VsZWN0JzoNCgkJCXJldHVybiAhZGV2aWNlSXNBbmRyb2lkOw0KCQljYXNlICdpbnB1dCc6DQoJCQlzd2l0Y2ggKHRhcmdldC50eXBlKSB7DQoJCQljYXNlICdidXR0b24nOg0KCQkJY2FzZSAnY2hlY2tib3gnOg0KCQkJY2FzZSAnZmlsZSc6DQoJCQljYXNlICdpbWFnZSc6DQoJCQljYXNlICdyYWRpbyc6DQoJCQljYXNlICdzdWJtaXQnOg0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCg0KCQkJLy8gTm8gcG9pbnQgaW4gYXR0ZW1wdGluZyB0byBmb2N1cyBkaXNhYmxlZCBpbnB1dHMNCgkJCXJldHVybiAhdGFyZ2V0LmRpc2FibGVkICYmICF0YXJnZXQucmVhZE9ubHk7DQoJCWRlZmF1bHQ6DQoJCQlyZXR1cm4gKC9cYm5lZWRzZm9jdXNcYi8pLnRlc3QodGFyZ2V0LmNsYXNzTmFtZSk7DQoJCX0NCgl9Ow0KDQoNCgkvKioNCgkgKiBTZW5kIGEgY2xpY2sgZXZlbnQgdG8gdGhlIHNwZWNpZmllZCBlbGVtZW50Lg0KCSAqDQoJICogQHBhcmFtIHtFdmVudFRhcmdldHxFbGVtZW50fSB0YXJnZXRFbGVtZW50DQoJICogQHBhcmFtIHtFdmVudH0gZXZlbnQNCgkgKi8NCglGYXN0Q2xpY2sucHJvdG90eXBlLnNlbmRDbGljayA9IGZ1bmN0aW9uKHRhcmdldEVsZW1lbnQsIGV2ZW50KSB7DQoJCXZhciBjbGlja0V2ZW50LCB0b3VjaDsNCg0KCQkvLyBPbiBzb21lIEFuZHJvaWQgZGV2aWNlcyBhY3RpdmVFbGVtZW50IG5lZWRzIHRvIGJlIGJsdXJyZWQgb3RoZXJ3aXNlIHRoZSBzeW50aGV0aWMgY2xpY2sgd2lsbCBoYXZlIG5vIGVmZmVjdCAoIzI0KQ0KCQlpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICE9PSB0YXJnZXRFbGVtZW50KSB7DQoJCQlkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTsNCgkJfQ0KDQoJCXRvdWNoID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07DQoNCgkJLy8gU3ludGhlc2lzZSBhIGNsaWNrIGV2ZW50LCB3aXRoIGFuIGV4dHJhIGF0dHJpYnV0ZSBzbyBpdCBjYW4gYmUgdHJhY2tlZA0KCQljbGlja0V2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyk7DQoJCWNsaWNrRXZlbnQuaW5pdE1vdXNlRXZlbnQodGhpcy5kZXRlcm1pbmVFdmVudFR5cGUodGFyZ2V0RWxlbWVudCksIHRydWUsIHRydWUsIHdpbmRvdywgMSwgdG91Y2guc2NyZWVuWCwgdG91Y2guc2NyZWVuWSwgdG91Y2guY2xpZW50WCwgdG91Y2guY2xpZW50WSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIG51bGwpOw0KCQljbGlja0V2ZW50LmZvcndhcmRlZFRvdWNoRXZlbnQgPSB0cnVlOw0KCQl0YXJnZXRFbGVtZW50LmRpc3BhdGNoRXZlbnQoY2xpY2tFdmVudCk7DQoJfTsNCg0KCUZhc3RDbGljay5wcm90b3R5cGUuZGV0ZXJtaW5lRXZlbnRUeXBlID0gZnVuY3Rpb24odGFyZ2V0RWxlbWVudCkgew0KDQoJCS8vSXNzdWUgIzE1OTogQW5kcm9pZCBDaHJvbWUgU2VsZWN0IEJveCBkb2VzIG5vdCBvcGVuIHdpdGggYSBzeW50aGV0aWMgY2xpY2sgZXZlbnQNCgkJaWYgKGRldmljZUlzQW5kcm9pZCAmJiB0YXJnZXRFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3NlbGVjdCcpIHsNCgkJCXJldHVybiAnbW91c2Vkb3duJzsNCgkJfQ0KDQoJCXJldHVybiAnY2xpY2snOw0KCX07DQoNCg0KCS8qKg0KCSAqIEBwYXJhbSB7RXZlbnRUYXJnZXR8RWxlbWVudH0gdGFyZ2V0RWxlbWVudA0KCSAqLw0KCUZhc3RDbGljay5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbih0YXJnZXRFbGVtZW50KSB7DQoJCXZhciBsZW5ndGg7DQoNCgkJLy8gSXNzdWUgIzE2MDogb24gaU9TIDcsIHNvbWUgaW5wdXQgZWxlbWVudHMgKGUuZy4gZGF0ZSBkYXRldGltZSBtb250aCkgdGhyb3cgYSB2YWd1ZSBUeXBlRXJyb3Igb24gc2V0U2VsZWN0aW9uUmFuZ2UuIFRoZXNlIGVsZW1lbnRzIGRvbid0IGhhdmUgYW4gaW50ZWdlciB2YWx1ZSBmb3IgdGhlIHNlbGVjdGlvblN0YXJ0IGFuZCBzZWxlY3Rpb25FbmQgcHJvcGVydGllcywgYnV0IHVuZm9ydHVuYXRlbHkgdGhhdCBjYW4ndCBiZSB1c2VkIGZvciBkZXRlY3Rpb24gYmVjYXVzZSBhY2Nlc3NpbmcgdGhlIHByb3BlcnRpZXMgYWxzbyB0aHJvd3MgYSBUeXBlRXJyb3IuIEp1c3QgY2hlY2sgdGhlIHR5cGUgaW5zdGVhZC4gRmlsZWQgYXMgQXBwbGUgYnVnICMxNTEyMjcyNC4NCgkJaWYgKGRldmljZUlzSU9TICYmIHRhcmdldEVsZW1lbnQuc2V0U2VsZWN0aW9uUmFuZ2UgJiYgdGFyZ2V0RWxlbWVudC50eXBlLmluZGV4T2YoJ2RhdGUnKSAhPT0gMCAmJiB0YXJnZXRFbGVtZW50LnR5cGUgIT09ICd0aW1lJyAmJiB0YXJnZXRFbGVtZW50LnR5cGUgIT09ICdtb250aCcgJiYgdGFyZ2V0RWxlbWVudC50eXBlICE9PSAnZW1haWwnKSB7DQoJCQlsZW5ndGggPSB0YXJnZXRFbGVtZW50LnZhbHVlLmxlbmd0aDsNCgkJCXRhcmdldEVsZW1lbnQuc2V0U2VsZWN0aW9uUmFuZ2UobGVuZ3RoLCBsZW5ndGgpOw0KCQl9IGVsc2Ugew0KCQkJdGFyZ2V0RWxlbWVudC5mb2N1cygpOw0KCQl9DQoJfTsNCg0KDQoJLyoqDQoJICogQ2hlY2sgd2hldGhlciB0aGUgZ2l2ZW4gdGFyZ2V0IGVsZW1lbnQgaXMgYSBjaGlsZCBvZiBhIHNjcm9sbGFibGUgbGF5ZXIgYW5kIGlmIHNvLCBzZXQgYSBmbGFnIG9uIGl0Lg0KCSAqDQoJICogQHBhcmFtIHtFdmVudFRhcmdldHxFbGVtZW50fSB0YXJnZXRFbGVtZW50DQoJICovDQoJRmFzdENsaWNrLnByb3RvdHlwZS51cGRhdGVTY3JvbGxQYXJlbnQgPSBmdW5jdGlvbih0YXJnZXRFbGVtZW50KSB7DQoJCXZhciBzY3JvbGxQYXJlbnQsIHBhcmVudEVsZW1lbnQ7DQoNCgkJc2Nyb2xsUGFyZW50ID0gdGFyZ2V0RWxlbWVudC5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQ7DQoNCgkJLy8gQXR0ZW1wdCB0byBkaXNjb3ZlciB3aGV0aGVyIHRoZSB0YXJnZXQgZWxlbWVudCBpcyBjb250YWluZWQgd2l0aGluIGEgc2Nyb2xsYWJsZSBsYXllci4gUmUtY2hlY2sgaWYgdGhlDQoJCS8vIHRhcmdldCBlbGVtZW50IHdhcyBtb3ZlZCB0byBhbm90aGVyIHBhcmVudC4NCgkJaWYgKCFzY3JvbGxQYXJlbnQgfHwgIXNjcm9sbFBhcmVudC5jb250YWlucyh0YXJnZXRFbGVtZW50KSkgew0KCQkJcGFyZW50RWxlbWVudCA9IHRhcmdldEVsZW1lbnQ7DQoJCQlkbyB7DQoJCQkJaWYgKHBhcmVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0ID4gcGFyZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIHsNCgkJCQkJc2Nyb2xsUGFyZW50ID0gcGFyZW50RWxlbWVudDsNCgkJCQkJdGFyZ2V0RWxlbWVudC5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQgPSBwYXJlbnRFbGVtZW50Ow0KCQkJCQlicmVhazsNCgkJCQl9DQoNCgkJCQlwYXJlbnRFbGVtZW50ID0gcGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50Ow0KCQkJfSB3aGlsZSAocGFyZW50RWxlbWVudCk7DQoJCX0NCg0KCQkvLyBBbHdheXMgdXBkYXRlIHRoZSBzY3JvbGwgdG9wIHRyYWNrZXIgaWYgcG9zc2libGUuDQoJCWlmIChzY3JvbGxQYXJlbnQpIHsNCgkJCXNjcm9sbFBhcmVudC5mYXN0Q2xpY2tMYXN0U2Nyb2xsVG9wID0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcDsNCgkJfQ0KCX07DQoNCg0KCS8qKg0KCSAqIEBwYXJhbSB7RXZlbnRUYXJnZXR9IHRhcmdldEVsZW1lbnQNCgkgKiBAcmV0dXJucyB7RWxlbWVudHxFdmVudFRhcmdldH0NCgkgKi8NCglGYXN0Q2xpY2sucHJvdG90eXBlLmdldFRhcmdldEVsZW1lbnRGcm9tRXZlbnRUYXJnZXQgPSBmdW5jdGlvbihldmVudFRhcmdldCkgew0KDQoJCS8vIE9uIHNvbWUgb2xkZXIgYnJvd3NlcnMgKG5vdGFibHkgU2FmYXJpIG9uIGlPUyA0LjEgLSBzZWUgaXNzdWUgIzU2KSB0aGUgZXZlbnQgdGFyZ2V0IG1heSBiZSBhIHRleHQgbm9kZS4NCgkJaWYgKGV2ZW50VGFyZ2V0Lm5vZGVUeXBlID09PSBOb2RlLlRFWFRfTk9ERSkgew0KCQkJcmV0dXJuIGV2ZW50VGFyZ2V0LnBhcmVudE5vZGU7DQoJCX0NCg0KCQlyZXR1cm4gZXZlbnRUYXJnZXQ7DQoJfTsNCg0KDQoJLyoqDQoJICogT24gdG91Y2ggc3RhcnQsIHJlY29yZCB0aGUgcG9zaXRpb24gYW5kIHNjcm9sbCBvZmZzZXQuDQoJICoNCgkgKiBAcGFyYW0ge0V2ZW50fSBldmVudA0KCSAqIEByZXR1cm5zIHtib29sZWFufQ0KCSAqLw0KCUZhc3RDbGljay5wcm90b3R5cGUub25Ub3VjaFN0YXJ0ID0gZnVuY3Rpb24oZXZlbnQpIHsNCgkJdmFyIHRhcmdldEVsZW1lbnQsIHRvdWNoLCBzZWxlY3Rpb247DQoNCgkJLy8gSWdub3JlIG11bHRpcGxlIHRvdWNoZXMsIG90aGVyd2lzZSBwaW5jaC10by16b29tIGlzIHByZXZlbnRlZCBpZiBib3RoIGZpbmdlcnMgYXJlIG9uIHRoZSBGYXN0Q2xpY2sgZWxlbWVudCAoaXNzdWUgIzExMSkuDQoJCWlmIChldmVudC50YXJnZXRUb3VjaGVzLmxlbmd0aCA+IDEpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoNCgkJdGFyZ2V0RWxlbWVudCA9IHRoaXMuZ2V0VGFyZ2V0RWxlbWVudEZyb21FdmVudFRhcmdldChldmVudC50YXJnZXQpOw0KCQl0b3VjaCA9IGV2ZW50LnRhcmdldFRvdWNoZXNbMF07DQoNCgkJaWYgKGRldmljZUlzSU9TKSB7DQoNCgkJCS8vIE9ubHkgdHJ1c3RlZCBldmVudHMgd2lsbCBkZXNlbGVjdCB0ZXh0IG9uIGlPUyAoaXNzdWUgIzQ5KQ0KCQkJc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpOw0KCQkJaWYgKHNlbGVjdGlvbi5yYW5nZUNvdW50ICYmICFzZWxlY3Rpb24uaXNDb2xsYXBzZWQpIHsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0NCg0KCQkJaWYgKCFkZXZpY2VJc0lPUzQpIHsNCg0KCQkJCS8vIFdlaXJkIHRoaW5ncyBoYXBwZW4gb24gaU9TIHdoZW4gYW4gYWxlcnQgb3IgY29uZmlybSBkaWFsb2cgaXMgb3BlbmVkIGZyb20gYSBjbGljayBldmVudCBjYWxsYmFjayAoaXNzdWUgIzIzKToNCgkJCQkvLyB3aGVuIHRoZSB1c2VyIG5leHQgdGFwcyBhbnl3aGVyZSBlbHNlIG9uIHRoZSBwYWdlLCBuZXcgdG91Y2hzdGFydCBhbmQgdG91Y2hlbmQgZXZlbnRzIGFyZSBkaXNwYXRjaGVkDQoJCQkJLy8gd2l0aCB0aGUgc2FtZSBpZGVudGlmaWVyIGFzIHRoZSB0b3VjaCBldmVudCB0aGF0IHByZXZpb3VzbHkgdHJpZ2dlcmVkIHRoZSBjbGljayB0aGF0IHRyaWdnZXJlZCB0aGUgYWxlcnQuDQoJCQkJLy8gU2FkbHksIHRoZXJlIGlzIGFuIGlzc3VlIG9uIGlPUyA0IHRoYXQgY2F1c2VzIHNvbWUgbm9ybWFsIHRvdWNoIGV2ZW50cyB0byBoYXZlIHRoZSBzYW1lIGlkZW50aWZpZXIgYXMgYW4NCgkJCQkvLyBpbW1lZGlhdGVseSBwcmVjZWVkaW5nIHRvdWNoIGV2ZW50IChpc3N1ZSAjNTIpLCBzbyB0aGlzIGZpeCBpcyB1bmF2YWlsYWJsZSBvbiB0aGF0IHBsYXRmb3JtLg0KCQkJCS8vIElzc3VlIDEyMDogdG91Y2guaWRlbnRpZmllciBpcyAwIHdoZW4gQ2hyb21lIGRldiB0b29scyAnRW11bGF0ZSB0b3VjaCBldmVudHMnIGlzIHNldCB3aXRoIGFuIGlPUyBkZXZpY2UgVUEgc3RyaW5nLA0KCQkJCS8vIHdoaWNoIGNhdXNlcyBhbGwgdG91Y2ggZXZlbnRzIHRvIGJlIGlnbm9yZWQuIEFzIHRoaXMgYmxvY2sgb25seSBhcHBsaWVzIHRvIGlPUywgYW5kIGlPUyBpZGVudGlmaWVycyBhcmUgYWx3YXlzIGxvbmcsDQoJCQkJLy8gcmFuZG9tIGludGVnZXJzLCBpdCdzIHNhZmUgdG8gdG8gY29udGludWUgaWYgdGhlIGlkZW50aWZpZXIgaXMgMCBoZXJlLg0KCQkJCWlmICh0b3VjaC5pZGVudGlmaWVyICYmIHRvdWNoLmlkZW50aWZpZXIgPT09IHRoaXMubGFzdFRvdWNoSWRlbnRpZmllcikgew0KCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfQ0KDQoJCQkJdGhpcy5sYXN0VG91Y2hJZGVudGlmaWVyID0gdG91Y2guaWRlbnRpZmllcjsNCg0KCQkJCS8vIElmIHRoZSB0YXJnZXQgZWxlbWVudCBpcyBhIGNoaWxkIG9mIGEgc2Nyb2xsYWJsZSBsYXllciAodXNpbmcgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoKSBhbmQ6DQoJCQkJLy8gMSkgdGhlIHVzZXIgZG9lcyBhIGZsaW5nIHNjcm9sbCBvbiB0aGUgc2Nyb2xsYWJsZSBsYXllcg0KCQkJCS8vIDIpIHRoZSB1c2VyIHN0b3BzIHRoZSBmbGluZyBzY3JvbGwgd2l0aCBhbm90aGVyIHRhcA0KCQkJCS8vIHRoZW4gdGhlIGV2ZW50LnRhcmdldCBvZiB0aGUgbGFzdCAndG91Y2hlbmQnIGV2ZW50IHdpbGwgYmUgdGhlIGVsZW1lbnQgdGhhdCB3YXMgdW5kZXIgdGhlIHVzZXIncyBmaW5nZXINCgkJCQkvLyB3aGVuIHRoZSBmbGluZyBzY3JvbGwgd2FzIHN0YXJ0ZWQsIGNhdXNpbmcgRmFzdENsaWNrIHRvIHNlbmQgYSBjbGljayBldmVudCB0byB0aGF0IGxheWVyIC0gdW5sZXNzIGEgY2hlY2sNCgkJCQkvLyBpcyBtYWRlIHRvIGVuc3VyZSB0aGF0IGEgcGFyZW50IGxheWVyIHdhcyBub3Qgc2Nyb2xsZWQgYmVmb3JlIHNlbmRpbmcgYSBzeW50aGV0aWMgY2xpY2sgKGlzc3VlICM0MikuDQoJCQkJdGhpcy51cGRhdGVTY3JvbGxQYXJlbnQodGFyZ2V0RWxlbWVudCk7DQoJCQl9DQoJCX0NCg0KCQl0aGlzLnRyYWNraW5nQ2xpY2sgPSB0cnVlOw0KCQl0aGlzLnRyYWNraW5nQ2xpY2tTdGFydCA9IGV2ZW50LnRpbWVTdGFtcDsNCgkJdGhpcy50YXJnZXRFbGVtZW50ID0gdGFyZ2V0RWxlbWVudDsNCg0KCQl0aGlzLnRvdWNoU3RhcnRYID0gdG91Y2gucGFnZVg7DQoJCXRoaXMudG91Y2hTdGFydFkgPSB0b3VjaC5wYWdlWTsNCg0KCQkvLyBQcmV2ZW50IHBoYW50b20gY2xpY2tzIG9uIGZhc3QgZG91YmxlLXRhcCAoaXNzdWUgIzM2KQ0KCQlpZiAoKGV2ZW50LnRpbWVTdGFtcCAtIHRoaXMubGFzdENsaWNrVGltZSkgPCB0aGlzLnRhcERlbGF5KSB7DQoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQl9DQoNCgkJcmV0dXJuIHRydWU7DQoJfTsNCg0KDQoJLyoqDQoJICogQmFzZWQgb24gYSB0b3VjaG1vdmUgZXZlbnQgb2JqZWN0LCBjaGVjayB3aGV0aGVyIHRoZSB0b3VjaCBoYXMgbW92ZWQgcGFzdCBhIGJvdW5kYXJ5IHNpbmNlIGl0IHN0YXJ0ZWQuDQoJICoNCgkgKiBAcGFyYW0ge0V2ZW50fSBldmVudA0KCSAqIEByZXR1cm5zIHtib29sZWFufQ0KCSAqLw0KCUZhc3RDbGljay5wcm90b3R5cGUudG91Y2hIYXNNb3ZlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7DQoJCXZhciB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLCBib3VuZGFyeSA9IHRoaXMudG91Y2hCb3VuZGFyeTsNCg0KCQlpZiAoTWF0aC5hYnModG91Y2gucGFnZVggLSB0aGlzLnRvdWNoU3RhcnRYKSA+IGJvdW5kYXJ5IHx8IE1hdGguYWJzKHRvdWNoLnBhZ2VZIC0gdGhpcy50b3VjaFN0YXJ0WSkgPiBib3VuZGFyeSkgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCg0KCQlyZXR1cm4gZmFsc2U7DQoJfTsNCg0KDQoJLyoqDQoJICogVXBkYXRlIHRoZSBsYXN0IHBvc2l0aW9uLg0KCSAqDQoJICogQHBhcmFtIHtFdmVudH0gZXZlbnQNCgkgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCgkgKi8NCglGYXN0Q2xpY2sucHJvdG90eXBlLm9uVG91Y2hNb3ZlID0gZnVuY3Rpb24oZXZlbnQpIHsNCgkJaWYgKCF0aGlzLnRyYWNraW5nQ2xpY2spIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoNCgkJLy8gSWYgdGhlIHRvdWNoIGhhcyBtb3ZlZCwgY2FuY2VsIHRoZSBjbGljayB0cmFja2luZw0KCQlpZiAodGhpcy50YXJnZXRFbGVtZW50ICE9PSB0aGlzLmdldFRhcmdldEVsZW1lbnRGcm9tRXZlbnRUYXJnZXQoZXZlbnQudGFyZ2V0KSB8fCB0aGlzLnRvdWNoSGFzTW92ZWQoZXZlbnQpKSB7DQoJCQl0aGlzLnRyYWNraW5nQ2xpY2sgPSBmYWxzZTsNCgkJCXRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7DQoJCX0NCg0KCQlyZXR1cm4gdHJ1ZTsNCgl9Ow0KDQoNCgkvKioNCgkgKiBBdHRlbXB0IHRvIGZpbmQgdGhlIGxhYmVsbGVkIGNvbnRyb2wgZm9yIHRoZSBnaXZlbiBsYWJlbCBlbGVtZW50Lg0KCSAqDQoJICogQHBhcmFtIHtFdmVudFRhcmdldHxIVE1MTGFiZWxFbGVtZW50fSBsYWJlbEVsZW1lbnQNCgkgKiBAcmV0dXJucyB7RWxlbWVudHxudWxsfQ0KCSAqLw0KCUZhc3RDbGljay5wcm90b3R5cGUuZmluZENvbnRyb2wgPSBmdW5jdGlvbihsYWJlbEVsZW1lbnQpIHsNCg0KCQkvLyBGYXN0IHBhdGggZm9yIG5ld2VyIGJyb3dzZXJzIHN1cHBvcnRpbmcgdGhlIEhUTUw1IGNvbnRyb2wgYXR0cmlidXRlDQoJCWlmIChsYWJlbEVsZW1lbnQuY29udHJvbCAhPT0gdW5kZWZpbmVkKSB7DQoJCQlyZXR1cm4gbGFiZWxFbGVtZW50LmNvbnRyb2w7DQoJCX0NCg0KCQkvLyBBbGwgYnJvd3NlcnMgdW5kZXIgdGVzdCB0aGF0IHN1cHBvcnQgdG91Y2ggZXZlbnRzIGFsc28gc3VwcG9ydCB0aGUgSFRNTDUgaHRtbEZvciBhdHRyaWJ1dGUNCgkJaWYgKGxhYmVsRWxlbWVudC5odG1sRm9yKSB7DQoJCQlyZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobGFiZWxFbGVtZW50Lmh0bWxGb3IpOw0KCQl9DQoNCgkJLy8gSWYgbm8gZm9yIGF0dHJpYnV0ZSBleGlzdHMsIGF0dGVtcHQgdG8gcmV0cmlldmUgdGhlIGZpcnN0IGxhYmVsbGFibGUgZGVzY2VuZGFudCBlbGVtZW50DQoJCS8vIHRoZSBsaXN0IG9mIHdoaWNoIGlzIGRlZmluZWQgaGVyZTogaHR0cDovL3d3dy53My5vcmcvVFIvaHRtbDUvZm9ybXMuaHRtbCNjYXRlZ29yeS1sYWJlbA0KCQlyZXR1cm4gbGFiZWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvbiwgaW5wdXQ6bm90KFt0eXBlPWhpZGRlbl0pLCBrZXlnZW4sIG1ldGVyLCBvdXRwdXQsIHByb2dyZXNzLCBzZWxlY3QsIHRleHRhcmVhJyk7DQoJfTsNCg0KDQoJLyoqDQoJICogT24gdG91Y2ggZW5kLCBkZXRlcm1pbmUgd2hldGhlciB0byBzZW5kIGEgY2xpY2sgZXZlbnQgYXQgb25jZS4NCgkgKg0KCSAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50DQoJICogQHJldHVybnMge2Jvb2xlYW59DQoJICovDQoJRmFzdENsaWNrLnByb3RvdHlwZS5vblRvdWNoRW5kID0gZnVuY3Rpb24oZXZlbnQpIHsNCgkJdmFyIGZvckVsZW1lbnQsIHRyYWNraW5nQ2xpY2tTdGFydCwgdGFyZ2V0VGFnTmFtZSwgc2Nyb2xsUGFyZW50LCB0b3VjaCwgdGFyZ2V0RWxlbWVudCA9IHRoaXMudGFyZ2V0RWxlbWVudDsNCg0KCQlpZiAoIXRoaXMudHJhY2tpbmdDbGljaykgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCg0KCQkvLyBQcmV2ZW50IHBoYW50b20gY2xpY2tzIG9uIGZhc3QgZG91YmxlLXRhcCAoaXNzdWUgIzM2KQ0KCQlpZiAoKGV2ZW50LnRpbWVTdGFtcCAtIHRoaXMubGFzdENsaWNrVGltZSkgPCB0aGlzLnRhcERlbGF5KSB7DQoJCQl0aGlzLmNhbmNlbE5leHRDbGljayA9IHRydWU7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCWlmICgoZXZlbnQudGltZVN0YW1wIC0gdGhpcy50cmFja2luZ0NsaWNrU3RhcnQpID4gdGhpcy50YXBUaW1lb3V0KSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCS8vIFJlc2V0IHRvIHByZXZlbnQgd3JvbmcgY2xpY2sgY2FuY2VsIG9uIGlucHV0IChpc3N1ZSAjMTU2KS4NCgkJdGhpcy5jYW5jZWxOZXh0Q2xpY2sgPSBmYWxzZTsNCg0KCQl0aGlzLmxhc3RDbGlja1RpbWUgPSBldmVudC50aW1lU3RhbXA7DQoNCgkJdHJhY2tpbmdDbGlja1N0YXJ0ID0gdGhpcy50cmFja2luZ0NsaWNrU3RhcnQ7DQoJCXRoaXMudHJhY2tpbmdDbGljayA9IGZhbHNlOw0KCQl0aGlzLnRyYWNraW5nQ2xpY2tTdGFydCA9IDA7DQoNCgkJLy8gT24gc29tZSBpT1MgZGV2aWNlcywgdGhlIHRhcmdldEVsZW1lbnQgc3VwcGxpZWQgd2l0aCB0aGUgZXZlbnQgaXMgaW52YWxpZCBpZiB0aGUgbGF5ZXINCgkJLy8gaXMgcGVyZm9ybWluZyBhIHRyYW5zaXRpb24gb3Igc2Nyb2xsLCBhbmQgaGFzIHRvIGJlIHJlLWRldGVjdGVkIG1hbnVhbGx5LiBOb3RlIHRoYXQNCgkJLy8gZm9yIHRoaXMgdG8gZnVuY3Rpb24gY29ycmVjdGx5LCBpdCBtdXN0IGJlIGNhbGxlZCAqYWZ0ZXIqIHRoZSBldmVudCB0YXJnZXQgaXMgY2hlY2tlZCENCgkJLy8gU2VlIGlzc3VlICM1NzsgYWxzbyBmaWxlZCBhcyByZGFyOi8vMTMwNDg1ODkgLg0KCQlpZiAoZGV2aWNlSXNJT1NXaXRoQmFkVGFyZ2V0KSB7DQoJCQl0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdOw0KDQoJCQkvLyBJbiBjZXJ0YWluIGNhc2VzIGFyZ3VtZW50cyBvZiBlbGVtZW50RnJvbVBvaW50IGNhbiBiZSBuZWdhdGl2ZSwgc28gcHJldmVudCBzZXR0aW5nIHRhcmdldEVsZW1lbnQgdG8gbnVsbA0KCQkJdGFyZ2V0RWxlbWVudCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQodG91Y2gucGFnZVggLSB3aW5kb3cucGFnZVhPZmZzZXQsIHRvdWNoLnBhZ2VZIC0gd2luZG93LnBhZ2VZT2Zmc2V0KSB8fCB0YXJnZXRFbGVtZW50Ow0KCQkJdGFyZ2V0RWxlbWVudC5mYXN0Q2xpY2tTY3JvbGxQYXJlbnQgPSB0aGlzLnRhcmdldEVsZW1lbnQuZmFzdENsaWNrU2Nyb2xsUGFyZW50Ow0KCQl9DQoNCgkJdGFyZ2V0VGFnTmFtZSA9IHRhcmdldEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpOw0KCQlpZiAodGFyZ2V0VGFnTmFtZSA9PT0gJ2xhYmVsJykgew0KCQkJZm9yRWxlbWVudCA9IHRoaXMuZmluZENvbnRyb2wodGFyZ2V0RWxlbWVudCk7DQoJCQlpZiAoZm9yRWxlbWVudCkgew0KCQkJCXRoaXMuZm9jdXModGFyZ2V0RWxlbWVudCk7DQoJCQkJaWYgKGRldmljZUlzQW5kcm9pZCkgew0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfQ0KDQoJCQkJdGFyZ2V0RWxlbWVudCA9IGZvckVsZW1lbnQ7DQoJCQl9DQoJCX0gZWxzZSBpZiAodGhpcy5uZWVkc0ZvY3VzKHRhcmdldEVsZW1lbnQpKSB7DQoNCgkJCS8vIENhc2UgMTogSWYgdGhlIHRvdWNoIHN0YXJ0ZWQgYSB3aGlsZSBhZ28gKGJlc3QgZ3Vlc3MgaXMgMTAwbXMgYmFzZWQgb24gdGVzdHMgZm9yIGlzc3VlICMzNikgdGhlbiBmb2N1cyB3aWxsIGJlIHRyaWdnZXJlZCBhbnl3YXkuIFJldHVybiBlYXJseSBhbmQgdW5zZXQgdGhlIHRhcmdldCBlbGVtZW50IHJlZmVyZW5jZSBzbyB0aGF0IHRoZSBzdWJzZXF1ZW50IGNsaWNrIHdpbGwgYmUgYWxsb3dlZCB0aHJvdWdoLg0KCQkJLy8gQ2FzZSAyOiBXaXRob3V0IHRoaXMgZXhjZXB0aW9uIGZvciBpbnB1dCBlbGVtZW50cyB0YXBwZWQgd2hlbiB0aGUgZG9jdW1lbnQgaXMgY29udGFpbmVkIGluIGFuIGlmcmFtZSwgdGhlbiBhbnkgaW5wdXR0ZWQgdGV4dCB3b24ndCBiZSB2aXNpYmxlIGV2ZW4gdGhvdWdoIHRoZSB2YWx1ZSBhdHRyaWJ1dGUgaXMgdXBkYXRlZCBhcyB0aGUgdXNlciB0eXBlcyAoaXNzdWUgIzM3KS4NCgkJCWlmICgoZXZlbnQudGltZVN0YW1wIC0gdHJhY2tpbmdDbGlja1N0YXJ0KSA+IDEwMCB8fCAoZGV2aWNlSXNJT1MgJiYgd2luZG93LnRvcCAhPT0gd2luZG93ICYmIHRhcmdldFRhZ05hbWUgPT09ICdpbnB1dCcpKSB7DQoJCQkJdGhpcy50YXJnZXRFbGVtZW50ID0gbnVsbDsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoNCgkJCXRoaXMuZm9jdXModGFyZ2V0RWxlbWVudCk7DQoJCQl0aGlzLnNlbmRDbGljayh0YXJnZXRFbGVtZW50LCBldmVudCk7DQoNCgkJCS8vIFNlbGVjdCBlbGVtZW50cyBuZWVkIHRoZSBldmVudCB0byBnbyB0aHJvdWdoIG9uIGlPUyA0LCBvdGhlcndpc2UgdGhlIHNlbGVjdG9yIG1lbnUgd29uJ3Qgb3Blbi4NCgkJCS8vIEFsc28gdGhpcyBicmVha3Mgb3BlbmluZyBzZWxlY3RzIHdoZW4gVm9pY2VPdmVyIGlzIGFjdGl2ZSBvbiBpT1M2LCBpT1M3IChhbmQgcG9zc2libHkgb3RoZXJzKQ0KCQkJaWYgKCFkZXZpY2VJc0lPUyB8fCB0YXJnZXRUYWdOYW1lICE9PSAnc2VsZWN0Jykgew0KCQkJCXRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7DQoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsNCgkJCX0NCg0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoNCgkJaWYgKGRldmljZUlzSU9TICYmICFkZXZpY2VJc0lPUzQpIHsNCg0KCQkJLy8gRG9uJ3Qgc2VuZCBhIHN5bnRoZXRpYyBjbGljayBldmVudCBpZiB0aGUgdGFyZ2V0IGVsZW1lbnQgaXMgY29udGFpbmVkIHdpdGhpbiBhIHBhcmVudCBsYXllciB0aGF0IHdhcyBzY3JvbGxlZA0KCQkJLy8gYW5kIHRoaXMgdGFwIGlzIGJlaW5nIHVzZWQgdG8gc3RvcCB0aGUgc2Nyb2xsaW5nICh1c3VhbGx5IGluaXRpYXRlZCBieSBhIGZsaW5nIC0gaXNzdWUgIzQyKS4NCgkJCXNjcm9sbFBhcmVudCA9IHRhcmdldEVsZW1lbnQuZmFzdENsaWNrU2Nyb2xsUGFyZW50Ow0KCQkJaWYgKHNjcm9sbFBhcmVudCAmJiBzY3JvbGxQYXJlbnQuZmFzdENsaWNrTGFzdFNjcm9sbFRvcCAhPT0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCkgew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQl9DQoNCgkJLy8gUHJldmVudCB0aGUgYWN0dWFsIGNsaWNrIGZyb20gZ29pbmcgdGhvdWdoIC0gdW5sZXNzIHRoZSB0YXJnZXQgbm9kZSBpcyBtYXJrZWQgYXMgcmVxdWlyaW5nDQoJCS8vIHJlYWwgY2xpY2tzIG9yIGlmIGl0IGlzIGluIHRoZSB3aGl0ZWxpc3QgaW4gd2hpY2ggY2FzZSBvbmx5IG5vbi1wcm9ncmFtbWF0aWMgY2xpY2tzIGFyZSBwZXJtaXR0ZWQuDQoJCWlmICghdGhpcy5uZWVkc0NsaWNrKHRhcmdldEVsZW1lbnQpKSB7DQoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJdGhpcy5zZW5kQ2xpY2sodGFyZ2V0RWxlbWVudCwgZXZlbnQpOw0KCQl9DQoNCgkJcmV0dXJuIGZhbHNlOw0KCX07DQoNCg0KCS8qKg0KCSAqIE9uIHRvdWNoIGNhbmNlbCwgc3RvcCB0cmFja2luZyB0aGUgY2xpY2suDQoJICoNCgkgKiBAcmV0dXJucyB7dm9pZH0NCgkgKi8NCglGYXN0Q2xpY2sucHJvdG90eXBlLm9uVG91Y2hDYW5jZWwgPSBmdW5jdGlvbigpIHsNCgkJdGhpcy50cmFja2luZ0NsaWNrID0gZmFsc2U7DQoJCXRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7DQoJfTsNCg0KDQoJLyoqDQoJICogRGV0ZXJtaW5lIG1vdXNlIGV2ZW50cyB3aGljaCBzaG91bGQgYmUgcGVybWl0dGVkLg0KCSAqDQoJICogQHBhcmFtIHtFdmVudH0gZXZlbnQNCgkgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCgkgKi8NCglGYXN0Q2xpY2sucHJvdG90eXBlLm9uTW91c2UgPSBmdW5jdGlvbihldmVudCkgew0KDQoJCS8vIElmIGEgdGFyZ2V0IGVsZW1lbnQgd2FzIG5ldmVyIHNldCAoYmVjYXVzZSBhIHRvdWNoIGV2ZW50IHdhcyBuZXZlciBmaXJlZCkgYWxsb3cgdGhlIGV2ZW50DQoJCWlmICghdGhpcy50YXJnZXRFbGVtZW50KSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCWlmIChldmVudC5mb3J3YXJkZWRUb3VjaEV2ZW50KSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCS8vIFByb2dyYW1tYXRpY2FsbHkgZ2VuZXJhdGVkIGV2ZW50cyB0YXJnZXRpbmcgYSBzcGVjaWZpYyBlbGVtZW50IHNob3VsZCBiZSBwZXJtaXR0ZWQNCgkJaWYgKCFldmVudC5jYW5jZWxhYmxlKSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCS8vIERlcml2ZSBhbmQgY2hlY2sgdGhlIHRhcmdldCBlbGVtZW50IHRvIHNlZSB3aGV0aGVyIHRoZSBtb3VzZSBldmVudCBuZWVkcyB0byBiZSBwZXJtaXR0ZWQ7DQoJCS8vIHVubGVzcyBleHBsaWNpdGx5IGVuYWJsZWQsIHByZXZlbnQgbm9uLXRvdWNoIGNsaWNrIGV2ZW50cyBmcm9tIHRyaWdnZXJpbmcgYWN0aW9ucywNCgkJLy8gdG8gcHJldmVudCBnaG9zdC9kb3VibGVjbGlja3MuDQoJCWlmICghdGhpcy5uZWVkc0NsaWNrKHRoaXMudGFyZ2V0RWxlbWVudCkgfHwgdGhpcy5jYW5jZWxOZXh0Q2xpY2spIHsNCg0KCQkJLy8gUHJldmVudCBhbnkgdXNlci1hZGRlZCBsaXN0ZW5lcnMgZGVjbGFyZWQgb24gRmFzdENsaWNrIGVsZW1lbnQgZnJvbSBiZWluZyBmaXJlZC4NCgkJCWlmIChldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24pIHsNCgkJCQlldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsNCgkJCX0gZWxzZSB7DQoNCgkJCQkvLyBQYXJ0IG9mIHRoZSBoYWNrIGZvciBicm93c2VycyB0aGF0IGRvbid0IHN1cHBvcnQgRXZlbnQjc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIChlLmcuIEFuZHJvaWQgMikNCgkJCQlldmVudC5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlOw0KCQkJfQ0KDQoJCQkvLyBDYW5jZWwgdGhlIGV2ZW50DQoJCQlldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KDQoJCS8vIElmIHRoZSBtb3VzZSBldmVudCBpcyBwZXJtaXR0ZWQsIHJldHVybiB0cnVlIGZvciB0aGUgYWN0aW9uIHRvIGdvIHRocm91Z2guDQoJCXJldHVybiB0cnVlOw0KCX07DQoNCg0KCS8qKg0KCSAqIE9uIGFjdHVhbCBjbGlja3MsIGRldGVybWluZSB3aGV0aGVyIHRoaXMgaXMgYSB0b3VjaC1nZW5lcmF0ZWQgY2xpY2ssIGEgY2xpY2sgYWN0aW9uIG9jY3VycmluZw0KCSAqIG5hdHVyYWxseSBhZnRlciBhIGRlbGF5IGFmdGVyIGEgdG91Y2ggKHdoaWNoIG5lZWRzIHRvIGJlIGNhbmNlbGxlZCB0byBhdm9pZCBkdXBsaWNhdGlvbiksIG9yDQoJICogYW4gYWN0dWFsIGNsaWNrIHdoaWNoIHNob3VsZCBiZSBwZXJtaXR0ZWQuDQoJICoNCgkgKiBAcGFyYW0ge0V2ZW50fSBldmVudA0KCSAqIEByZXR1cm5zIHtib29sZWFufQ0KCSAqLw0KCUZhc3RDbGljay5wcm90b3R5cGUub25DbGljayA9IGZ1bmN0aW9uKGV2ZW50KSB7DQoJCXZhciBwZXJtaXR0ZWQ7DQoNCgkJLy8gSXQncyBwb3NzaWJsZSBmb3IgYW5vdGhlciBGYXN0Q2xpY2stbGlrZSBsaWJyYXJ5IGRlbGl2ZXJlZCB3aXRoIHRoaXJkLXBhcnR5IGNvZGUgdG8gZmlyZSBhIGNsaWNrIGV2ZW50IGJlZm9yZSBGYXN0Q2xpY2sgZG9lcyAoaXNzdWUgIzQ0KS4gSW4gdGhhdCBjYXNlLCBzZXQgdGhlIGNsaWNrLXRyYWNraW5nIGZsYWcgYmFjayB0byBmYWxzZSBhbmQgcmV0dXJuIGVhcmx5LiBUaGlzIHdpbGwgY2F1c2Ugb25Ub3VjaEVuZCB0byByZXR1cm4gZWFybHkuDQoJCWlmICh0aGlzLnRyYWNraW5nQ2xpY2spIHsNCgkJCXRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7DQoJCQl0aGlzLnRyYWNraW5nQ2xpY2sgPSBmYWxzZTsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoNCgkJLy8gVmVyeSBvZGQgYmVoYXZpb3VyIG9uIGlPUyAoaXNzdWUgIzE4KTogaWYgYSBzdWJtaXQgZWxlbWVudCBpcyBwcmVzZW50IGluc2lkZSBhIGZvcm0gYW5kIHRoZSB1c2VyIGhpdHMgZW50ZXIgaW4gdGhlIGlPUyBzaW11bGF0b3Igb3IgY2xpY2tzIHRoZSBHbyBidXR0b24gb24gdGhlIHBvcC11cCBPUyBrZXlib2FyZCB0aGUgYSBraW5kIG9mICdmYWtlJyBjbGljayBldmVudCB3aWxsIGJlIHRyaWdnZXJlZCB3aXRoIHRoZSBzdWJtaXQtdHlwZSBpbnB1dCBlbGVtZW50IGFzIHRoZSB0YXJnZXQuDQoJCWlmIChldmVudC50YXJnZXQudHlwZSA9PT0gJ3N1Ym1pdCcgJiYgZXZlbnQuZGV0YWlsID09PSAwKSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCXBlcm1pdHRlZCA9IHRoaXMub25Nb3VzZShldmVudCk7DQoNCgkJLy8gT25seSB1bnNldCB0YXJnZXRFbGVtZW50IGlmIHRoZSBjbGljayBpcyBub3QgcGVybWl0dGVkLiBUaGlzIHdpbGwgZW5zdXJlIHRoYXQgdGhlIGNoZWNrIGZvciAhdGFyZ2V0RWxlbWVudCBpbiBvbk1vdXNlIGZhaWxzIGFuZCB0aGUgYnJvd3NlcidzIGNsaWNrIGRvZXNuJ3QgZ28gdGhyb3VnaC4NCgkJaWYgKCFwZXJtaXR0ZWQpIHsNCgkJCXRoaXMudGFyZ2V0RWxlbWVudCA9IG51bGw7DQoJCX0NCg0KCQkvLyBJZiBjbGlja3MgYXJlIHBlcm1pdHRlZCwgcmV0dXJuIHRydWUgZm9yIHRoZSBhY3Rpb24gdG8gZ28gdGhyb3VnaC4NCgkJcmV0dXJuIHBlcm1pdHRlZDsNCgl9Ow0KDQoNCgkvKioNCgkgKiBSZW1vdmUgYWxsIEZhc3RDbGljaydzIGV2ZW50IGxpc3RlbmVycy4NCgkgKg0KCSAqIEByZXR1cm5zIHt2b2lkfQ0KCSAqLw0KCUZhc3RDbGljay5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgbGF5ZXIgPSB0aGlzLmxheWVyOw0KDQoJCWlmIChkZXZpY2VJc0FuZHJvaWQpIHsNCgkJCWxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIHRoaXMub25Nb3VzZSwgdHJ1ZSk7DQoJCQlsYXllci5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLm9uTW91c2UsIHRydWUpOw0KCQkJbGF5ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZSwgdHJ1ZSk7DQoJCX0NCg0KCQlsYXllci5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljaywgdHJ1ZSk7DQoJCWxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCB0aGlzLm9uVG91Y2hTdGFydCwgZmFsc2UpOw0KCQlsYXllci5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLm9uVG91Y2hNb3ZlLCBmYWxzZSk7DQoJCWxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy5vblRvdWNoRW5kLCBmYWxzZSk7DQoJCWxheWVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgdGhpcy5vblRvdWNoQ2FuY2VsLCBmYWxzZSk7DQoJfTsNCg0KDQoJLyoqDQoJICogQ2hlY2sgd2hldGhlciBGYXN0Q2xpY2sgaXMgbmVlZGVkLg0KCSAqDQoJICogQHBhcmFtIHtFbGVtZW50fSBsYXllciBUaGUgbGF5ZXIgdG8gbGlzdGVuIG9uDQoJICovDQoJRmFzdENsaWNrLm5vdE5lZWRlZCA9IGZ1bmN0aW9uKGxheWVyKSB7DQoJCXZhciBtZXRhVmlld3BvcnQ7DQoJCXZhciBjaHJvbWVWZXJzaW9uOw0KCQl2YXIgYmxhY2tiZXJyeVZlcnNpb247DQoJCXZhciBmaXJlZm94VmVyc2lvbjsNCg0KCQkvLyBEZXZpY2VzIHRoYXQgZG9uJ3Qgc3VwcG9ydCB0b3VjaCBkb24ndCBuZWVkIEZhc3RDbGljaw0KCQlpZiAodHlwZW9mIHdpbmRvdy5vbnRvdWNoc3RhcnQgPT09ICd1bmRlZmluZWQnKSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KDQoJCS8vIENocm9tZSB2ZXJzaW9uIC0gemVybyBmb3Igb3RoZXIgYnJvd3NlcnMNCgkJY2hyb21lVmVyc2lvbiA9ICsoL0Nocm9tZVwvKFswLTldKykvLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudCkgfHwgWywwXSlbMV07DQoNCgkJaWYgKGNocm9tZVZlcnNpb24pIHsNCg0KCQkJaWYgKGRldmljZUlzQW5kcm9pZCkgew0KCQkJCW1ldGFWaWV3cG9ydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21ldGFbbmFtZT12aWV3cG9ydF0nKTsNCg0KCQkJCWlmIChtZXRhVmlld3BvcnQpIHsNCgkJCQkJLy8gQ2hyb21lIG9uIEFuZHJvaWQgd2l0aCB1c2VyLXNjYWxhYmxlPSJubyIgZG9lc24ndCBuZWVkIEZhc3RDbGljayAoaXNzdWUgIzg5KQ0KCQkJCQlpZiAobWV0YVZpZXdwb3J0LmNvbnRlbnQuaW5kZXhPZigndXNlci1zY2FsYWJsZT1ubycpICE9PSAtMSkgew0KCQkJCQkJcmV0dXJuIHRydWU7DQoJCQkJCX0NCgkJCQkJLy8gQ2hyb21lIDMyIGFuZCBhYm92ZSB3aXRoIHdpZHRoPWRldmljZS13aWR0aCBvciBsZXNzIGRvbid0IG5lZWQgRmFzdENsaWNrDQoJCQkJCWlmIChjaHJvbWVWZXJzaW9uID4gMzEgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoIDw9IHdpbmRvdy5vdXRlcldpZHRoKSB7DQoJCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJLy8gQ2hyb21lIGRlc2t0b3AgZG9lc24ndCBuZWVkIEZhc3RDbGljayAoaXNzdWUgIzE1KQ0KCQkJfSBlbHNlIHsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0NCgkJfQ0KDQoJCWlmIChkZXZpY2VJc0JsYWNrQmVycnkxMCkgew0KCQkJYmxhY2tiZXJyeVZlcnNpb24gPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9WZXJzaW9uXC8oWzAtOV0qKVwuKFswLTldKikvKTsNCg0KCQkJLy8gQmxhY2tCZXJyeSAxMC4zKyBkb2VzIG5vdCByZXF1aXJlIEZhc3RjbGljayBsaWJyYXJ5Lg0KCQkJLy8gaHR0cHM6Ly9naXRodWIuY29tL2Z0bGFicy9mYXN0Y2xpY2svaXNzdWVzLzI1MQ0KCQkJaWYgKGJsYWNrYmVycnlWZXJzaW9uWzFdID49IDEwICYmIGJsYWNrYmVycnlWZXJzaW9uWzJdID49IDMpIHsNCgkJCQltZXRhVmlld3BvcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW25hbWU9dmlld3BvcnRdJyk7DQoNCgkJCQlpZiAobWV0YVZpZXdwb3J0KSB7DQoJCQkJCS8vIHVzZXItc2NhbGFibGU9bm8gZWxpbWluYXRlcyBjbGljayBkZWxheS4NCgkJCQkJaWYgKG1ldGFWaWV3cG9ydC5jb250ZW50LmluZGV4T2YoJ3VzZXItc2NhbGFibGU9bm8nKSAhPT0gLTEpIHsNCgkJCQkJCXJldHVybiB0cnVlOw0KCQkJCQl9DQoJCQkJCS8vIHdpZHRoPWRldmljZS13aWR0aCAob3IgbGVzcyB0aGFuIGRldmljZS13aWR0aCkgZWxpbWluYXRlcyBjbGljayBkZWxheS4NCgkJCQkJaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxXaWR0aCA8PSB3aW5kb3cub3V0ZXJXaWR0aCkgew0KCQkJCQkJcmV0dXJuIHRydWU7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQkvLyBJRTEwIHdpdGggLW1zLXRvdWNoLWFjdGlvbjogbm9uZSBvciBtYW5pcHVsYXRpb24sIHdoaWNoIGRpc2FibGVzIGRvdWJsZS10YXAtdG8tem9vbSAoaXNzdWUgIzk3KQ0KCQlpZiAobGF5ZXIuc3R5bGUubXNUb3VjaEFjdGlvbiA9PT0gJ25vbmUnIHx8IGxheWVyLnN0eWxlLnRvdWNoQWN0aW9uID09PSAnbWFuaXB1bGF0aW9uJykgew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCg0KCQkvLyBGaXJlZm94IHZlcnNpb24gLSB6ZXJvIGZvciBvdGhlciBicm93c2Vycw0KCQlmaXJlZm94VmVyc2lvbiA9ICsoL0ZpcmVmb3hcLyhbMC05XSspLy5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQpIHx8IFssMF0pWzFdOw0KDQoJCWlmIChmaXJlZm94VmVyc2lvbiA+PSAyNykgew0KCQkJLy8gRmlyZWZveCAyNysgZG9lcyBub3QgaGF2ZSB0YXAgZGVsYXkgaWYgdGhlIGNvbnRlbnQgaXMgbm90IHpvb21hYmxlIC0gaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9OTIyODk2DQoNCgkJCW1ldGFWaWV3cG9ydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21ldGFbbmFtZT12aWV3cG9ydF0nKTsNCgkJCWlmIChtZXRhVmlld3BvcnQgJiYgKG1ldGFWaWV3cG9ydC5jb250ZW50LmluZGV4T2YoJ3VzZXItc2NhbGFibGU9bm8nKSAhPT0gLTEgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoIDw9IHdpbmRvdy5vdXRlcldpZHRoKSkgew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQl9DQoNCgkJLy8gSUUxMTogcHJlZml4ZWQgLW1zLXRvdWNoLWFjdGlvbiBpcyBubyBsb25nZXIgc3VwcG9ydGVkIGFuZCBpdCdzIHJlY29tZW5kZWQgdG8gdXNlIG5vbi1wcmVmaXhlZCB2ZXJzaW9uDQoJCS8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS93aW5kb3dzL2FwcHMvSGg3NjczMTMuYXNweA0KCQlpZiAobGF5ZXIuc3R5bGUudG91Y2hBY3Rpb24gPT09ICdub25lJyB8fCBsYXllci5zdHlsZS50b3VjaEFjdGlvbiA9PT0gJ21hbmlwdWxhdGlvbicpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoNCgkJcmV0dXJuIGZhbHNlOw0KCX07DQoNCg0KCS8qKg0KCSAqIEZhY3RvcnkgbWV0aG9kIGZvciBjcmVhdGluZyBhIEZhc3RDbGljayBvYmplY3QNCgkgKg0KCSAqIEBwYXJhbSB7RWxlbWVudH0gbGF5ZXIgVGhlIGxheWVyIHRvIGxpc3RlbiBvbg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gVGhlIG9wdGlvbnMgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHRzDQoJICovDQoJRmFzdENsaWNrLmF0dGFjaCA9IGZ1bmN0aW9uKGxheWVyLCBvcHRpb25zKSB7DQoJCXJldHVybiBuZXcgRmFzdENsaWNrKGxheWVyLCBvcHRpb25zKTsNCgl9Ow0KDQoNCglpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgZGVmaW5lLmFtZCA9PT0gJ29iamVjdCcgJiYgZGVmaW5lLmFtZCkgew0KDQoJCS8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4NCgkJZGVmaW5lKGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIEZhc3RDbGljazsNCgkJfSk7DQoJfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgew0KCQltb2R1bGUuZXhwb3J0cyA9IEZhc3RDbGljay5hdHRhY2g7DQoJCW1vZHVsZS5leHBvcnRzLkZhc3RDbGljayA9IEZhc3RDbGljazsNCgl9IGVsc2Ugew0KCQl3aW5kb3cuRmFzdENsaWNrID0gRmFzdENsaWNrOw0KCX0NCn0oKSk7DQo="></script>
<script type="text/javascript">
    window.addEventListener('load', function() {
        FastClick.attach(document.body);
    }, false);
    apiready = function() {
        $util.fixPage();
        $util.openFrame('goods_list_new_frm');
    };
</script>

</html>
